function cardMember(){return{restrict:"E",scope:{memberInfo:"=info"},templateUrl:"templates/cardMember.html"}}!function(){"use strict";angular.module("webapilabclient",["ngRoute","LocalStorageModule","angular-loading-bar"]),angular.module("webapilabclient").config(function($routeProvider){$routeProvider.when("/default",{templateUrl:"views/default.html"}).when("/account/login",{controller:"accountController",templateUrl:"views/account/login.html"}).when("/account/register",{controller:"accountController",templateUrl:"views/account/register.html"}).when("/members",{controller:"membersController",templateUrl:"views/members/index.html"}).when("/cities",{controller:"citiesController",templateUrl:"views/cities/index.html"}).otherwise({redirectTo:"/default"})}).config(function($httpProvider){$httpProvider.interceptors.push("authInterceptorService")}).constant("settings",{webapiurl:"http://webapilab-tab.azurewebsites.net/",webapiurlDev:"http://localhost:49284/",maxPageSize:25})}(),function(){"use strict";angular.module("webapilabclient").controller("accountController",["$scope","$location","$timeout","accountService","uiNotify",function($scope,$location,$timeout,accountService,uiNotify){$scope.loginData={userName:"MookieFumi",password:"mookiefumi"},accountService.fillAuthData(),$scope.authentication=accountService.authentication,$scope.savedSuccessfully=!1,$scope.messages=[],$scope.registration={userName:"",password:"",confirmPassword:"",name:"",surname:"",email:""},$scope.signUp=function(){$scope.messages=[],accountService.saveRegistration($scope.registration).then(function(){$scope.savedSuccessfully=!0,$scope.messages.push("User has been registered successfully, you will be redicted to login page in 2 seconds."),startTimer()},function(response){for(var key in response.data.ModelState)$scope.messages.push(response.data.ModelState[key][0])})},$scope.login=function(){accountService.login($scope.loginData).then(function(){$location.path("default")},function(err){uiNotify.show(err.error_description)})};var startTimer=function(){var timer=$timeout(function(){$timeout.cancel(timer),$location.path("/account/login")},2e3)}}])}(),function(){"use strict";angular.module("webapilabclient").controller("citiesController",["$http","citiesService","settings","uiNotify",function($http,citiesService,settings,uiNotify){function loadCities(){var nextPage=parseInt(vm.citiesPagination.pageIndex+1);citiesService.getAll(vm.cityToSearch,nextPage).then(function(result){vm.cities.push.apply(vm.cities,result.Data),vm.citiesPagination.hasNextPage=result.HasNextPage,vm.citiesPagination.pageIndex=result.PageIndex,vm.citiesPagination.count=result.Count},function(err){uiNotify.show(err)})}var vm=this;vm.citiesPagination={hasNextPage:!1,pageIndex:0,count:0},vm.cities=[],vm.cityToSearch="",vm.searchCities=function(clear){clear&&vm.clearCities(),loadCities()},vm.clearCities=function(){vm.cities=[],vm.citiesPagination={hasNextPage:!1,pageIndex:0,count:0}}}])}(),function(){"use strict";angular.module("webapilabclient").controller("membersController",["$http","membersService","settings","uiNotify",function($http,membersService,settings,uiNotify){var vm=this;vm.members=[],vm.getMembers=function(){membersService.getAll().then(function(result){vm.members=result},function(err){uiNotify.show(err)})}}])}(),function(){"use strict";angular.module("webapilabclient").controller("menuController",["$scope","$location","accountService",function($scope,$location,accountService){accountService.fillAuthData(),$scope.authentication=accountService.authentication,$scope.logOut=function(){accountService.logOut(),$location.path("/account/login")}}])}(),angular.module("webapilabclient").directive("cardCity",function(){return{restrict:"E",scope:{cityInfo:"=info"},templateUrl:"templates/cardCity.html"}}),angular.module("webapilabclient").directive("cardMember",cardMember),angular.module("webapilabclient").factory("accountService",["$http","$q","localStorageService","settings",function($http,$q,localStorageService,settings){var accountServiceFactory={},_authentication={isAuth:!1,userName:""},_saveRegistration=function(registration){return _logOut(),$http.post(settings.webapiurl+"api/account/register",registration).then(function(response){return response})},_login=function(loginData){var data="grant_type=password&username="+loginData.userName+"&password="+loginData.password,deferred=$q.defer();return $http.post(settings.webapiurl+"token",data,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(response){localStorageService.set("authorizationData",{token:response.access_token,userName:loginData.userName}),_authentication.isAuth=!0,_authentication.userName=loginData.userName,deferred.resolve(response)}).error(function(err){_logOut(),deferred.reject(err)}),deferred.promise},_logOut=function(){localStorageService.remove("authorizationData"),_authentication.isAuth=!1,_authentication.userName=""},_fillAuthData=function(){var authData=localStorageService.get("authorizationData");authData&&(_authentication.isAuth=!0,_authentication.userName=authData.userName)};return accountServiceFactory.saveRegistration=_saveRegistration,accountServiceFactory.login=_login,accountServiceFactory.logOut=_logOut,accountServiceFactory.fillAuthData=_fillAuthData,accountServiceFactory.authentication=_authentication,accountServiceFactory}]),function(){"use strict";angular.module("webapilabclient").factory("authInterceptorService",["$q","$location","localStorageService",function($q,$location,localStorageService){var authInterceptorServiceFactory={},_request=function(config){config.headers=config.headers||{};var authData=localStorageService.get("authorizationData");return authData&&(config.headers.Authorization="Bearer "+authData.token),config},_responseError=function(rejection){return 401===rejection.status&&$location.path("/account/login"),$q.reject(rejection)};return authInterceptorServiceFactory.request=_request,authInterceptorServiceFactory.responseError=_responseError,authInterceptorServiceFactory}])}(),function(){"use strict";angular.module("webapilabclient").factory("citiesService",["$http","$q","settings",function($http,$q,settings){var citiesServiceFactory={},_getAll=function(text,pageIndex){var deferred=$q.defer(),url=settings.webapiurl+"api/towns?name="+text+"&pageIndex="+parseInt(pageIndex)+"&pageSize="+settings.maxPageSize;return $http.get(url).success(function(response){deferred.resolve(response)}).error(function(err){deferred.reject(err)}),deferred.promise};return citiesServiceFactory.getAll=_getAll,citiesServiceFactory}])}(),function(){"use strict";angular.module("webapilabclient").factory("membersService",["$http","$q","settings",function($http,$q,settings){var membersServiceFactory={},_getAll=function(){var deferred=$q.defer(),url=settings.webapiurl+"api/members";return $http.get(url).success(function(response){deferred.resolve(response)}).error(function(err){deferred.reject(err)}),deferred.promise};return membersServiceFactory.getAll=_getAll,membersServiceFactory}])}(),angular.module("webapilabclient").factory("uiNotify",function(){var uiNotify={},_show=function(){};return uiNotify.show=_show,uiNotify});